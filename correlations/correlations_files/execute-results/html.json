{
  "hash": "b05c77392297bd07dc8c18230e6415f7",
  "result": {
    "markdown": "---\ntitle: \"Correlations\"\nformat: \n  html:\n    code-fold: true\neditor: visual\n---\n\n::: {.cell}\n\n:::\n\n\n\nPlease make sure you've read about variance within the <a href=\"../describingData/dispersion.html\" target=\"_blank\">dispersion section</a> before proceeding with this page.\n\nCorrelations capture how much two variables are associated with each other by calculating the proportion of the **total variance** explained by how much the two variables **vary together (explained below).** To understand this, we need to think about how each variable varies **independently, together** and compare the two. We'll use the **gapminder** data to look at how how life expectancy correlated with GDP in 2007:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gapminder)\nlibrary(ggplot2)\n\n# create a new data frame that only focuses on data from 2007\ngapminder_2007 <- subset(\n  gapminder,   # the data set\n  year == 2007     \n)\n\n# a reminder of the data frame\nrmarkdown::paged_table(head(gapminder_2007))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"country\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"continent\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"year\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"lifeExp\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"pop\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"gdpPercap\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Afghanistan\",\"2\":\"Asia\",\"3\":\"2007\",\"4\":\"43.828\",\"5\":\"31889923\",\"6\":\"974.5803\"},{\"1\":\"Albania\",\"2\":\"Europe\",\"3\":\"2007\",\"4\":\"76.423\",\"5\":\"3600523\",\"6\":\"5937.0295\"},{\"1\":\"Algeria\",\"2\":\"Africa\",\"3\":\"2007\",\"4\":\"72.301\",\"5\":\"33333216\",\"6\":\"6223.3675\"},{\"1\":\"Angola\",\"2\":\"Africa\",\"3\":\"2007\",\"4\":\"42.731\",\"5\":\"12420476\",\"6\":\"4797.2313\"},{\"1\":\"Argentina\",\"2\":\"Americas\",\"3\":\"2007\",\"4\":\"75.320\",\"5\":\"40301927\",\"6\":\"12779.3796\"},{\"1\":\"Australia\",\"2\":\"Oceania\",\"3\":\"2007\",\"4\":\"81.235\",\"5\":\"20434176\",\"6\":\"34435.3674\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Basic scatter plot\nggplot(\n  data = gapminder_2007, \n  aes(\n    x=gdpPercap, \n    y=lifeExp\n  )\n) + geom_point() +\n  theme(\n    text=element_text(\n      family=\"gochi\",\n      size = 20\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n*Note that in the figure above each dot represents an individual point from our data.Each dot represents an individual country (with the x-coordinte being the GDP per capita, and the y-coordinate being the Life Expectancy).*\n\nGenerally speaking, a correlation tells you how much of the total variance is explained by how much the variables vary together. To understand this, lets start by clarifying how you understand the variance of individual variables.\n\n## Variance of individual variables\n\nFor more insight into variance as a concept, have a look at [dispersion](../distributions/dispersion), but here we will focus on variance within the context of correlations. You have 2 variables, x (for the x-axis) and y (for the y-axis), and the variance for **each** of those is:\n\n$$\nvar_x = \\frac{\\sum(x_i-\\bar{x})^2}{N-1}\n$$\n\n$$\nvar_y = \\frac{\\sum(y_i-\\bar{y})^2}{N-1}\n$$\n\nJust a reminder of what each part of the formula is:\n\n$\\sum$ is saying to add together everything\n\n$x_i$ refers to each individual's x-score\n\n$y_i$ refers to each individual's y-score\n\n$\\bar{x}$ refers to the mean x-score across all participants\n\n$\\bar{y}$ refers to the mean y-score across all participants\n\n$N$ refers to the number of participants\n\n$N-1$ is **degrees of freedom**, used for this calculation as you are calculating the variance within a sample, rather than variance within the whole population (which you would just use N for; this is explained further in the [dispersion](../distributions/dispersion) section).\n\nThe $SD$ (Standard deviation; which is just the square root of variance) of how data is distributed around the mean $life$$expectancy$ (per capita) can be visualised as follows within the gapminder $gdp*lifeExpectancy$ in the light blue box:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Basic scatter plot\n\nlife_exp_resid <- ggplot(\n  data = gapminder_2007, \n  aes(\n    x=gdpPercap, \n    y=lifeExp\n  )\n) + \n  geom_point() +\n  geom_hline(\n    yintercept = mean(gapminder_2007$lifeExp), \n    linetype   = \"dashed\",  \n    color      = \"#006599\", \n    size       = 1\n  ) +\n  coord_cartesian(ylim = c(30, 85)) +\n  xlab(\"GDP per capita\") +\n  ylab(\"Life Expectancy\") +\n  geom_segment(\n    aes(\n      xend = gdpPercap,\n      yend = mean(lifeExp),\n      color = \"resid\"\n    )\n  ) + \n  theme(\n    legend.position = \"none\",\n    text=element_text(\n      family=\"gochi\",\n      size = 20\n    )\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nâ„¹ Please use `linewidth` instead.\n```\n:::\n\n```{.r .cell-code}\nggsave(\"life_exp_resid.png\", life_exp_resid)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSaving 7 x 5 in image\n```\n:::\n:::\n\n\n*Note that in the figure above the horizontal blue dotted line represent the mean of Life Expectancy. Variance is the total after squaring all the residuals (pink lines) and dividing this total by the* [degrees of freedom](../describingData/dispersion.html).\n\nLets look at the variance of GDP per capita:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngdp_resid <- ggplot(\n  data = gapminder_2007, \n  aes(\n    x=gdpPercap, \n    y=lifeExp\n  )\n) + \n  geom_point() +\n  geom_vline(\n    xintercept = mean(gapminder_2007$gdpPercap), \n    linetype   = \"dashed\",  \n    color      = \"#006599\", \n    size       = 1\n  ) +\n  coord_cartesian(ylim = c(30, 85)) +\n  xlab(\"GDP per capita\") +\n  ylab(\"Life Expectancy\") +\n  geom_segment(\n    aes(\n      xend = mean(gdpPercap),\n      yend = lifeExp,\n      color = \"resid\"\n    )\n  ) + theme(\n    legend.position = \"none\",\n    text=element_text(\n      family=\"gochi\",\n      size = 20\n    )\n  )\nggsave(\"gdp_resid.png\", gdp_resid)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSaving 7 x 5 in image\n```\n:::\n\n```{.r .cell-code}\ngdp_resid\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n*Note that in the figure above the vertical blue dotted line represents the mean gdp per capita. Variance is the total after squaring all the residuals (pink lines) and dividing this total by the* [degrees of freedom](../describingData/dispersion.html).\n\n## Total variance\n\nA correlation aims to explain how much of the $total$ $variance$ is explained by the overlapping variance between the x and y axes. So we need to capture the $total$ $variance$ separately for the x and y axes. We do this by multiplying the variance for $x$ by the variance for $y$ (and square rooting to control for the multiplication itself):\n\n$$\ntotalVariance = \\sqrt{\\frac{\\sum(x_i-\\bar{x})^2}{N-1}}*\\sqrt{\\frac{\\sum(y_i-\\bar{y})^2}{N-1}}\n$$\n\n(Which is the same as:\n\n$$\ntotalVariance = \\frac{\\sqrt{\\sum(x_i-\\bar{x})^2*\\sum(y_i-\\bar{y})^2}}{N-1}\n$$\n\n)\n\nOr, to use the figures above:\n\n|                     |                                                             |        |                                                         |\n|---------------------|-------------------------------------------------------------|--------|---------------------------------------------------------|\n| \\$Total\\$ \\$Var\\$ = | sqrt(![](life_exp_resid.png) \\\\\\^2) \\$\\$ \\\\frac{}{N-1} \\$\\$ | \\$\\*\\$ | sqrt(![](gdp_resid.png) \\\\\\^ 2) \\$\\$ \\\\frac{}{N-1} \\$\\$ |\n\nThis is analogous to understanding the total area of a rectangle by multiplying the length of each side with each other.\n\n### Shared variance between $x$ and $y$\n\nAn important thing to note, is that variance of a single variable, in this case x:\n\n$$\nvar_x = \\frac{\\sum(x_i-\\bar{x})^2}{N-1}\n$$\n\ncould also be written as:\n\n$$\nvar_x = \\frac{\\sum(x_i-\\bar{x})(x_i-\\bar{x})}{N-1}\n$$\n\nTo look at the amount that x and y vary together, we can adapt a formula for how much $x$ varies (with itself as written above) to now look at how much $x$ varies with $y$:\n\n$$\nvar_{xy} = \\frac{\\sum(x_i-\\bar{x})(\\color{red}{y_i-\\bar{y}})}{N-1}\n$$\n\nThis can be visualised as the residuals from the means multiplied by each other for each data point:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshared_resid <- ggplot(\n  data = gapminder_2007, \n  aes(\n    x=gdpPercap, \n    y=lifeExp\n  )\n) + \n  geom_point() +\n  geom_vline(\n    xintercept = mean(gapminder_2007$gdpPercap), \n    linetype   = \"dashed\",  \n    color      = \"#006599\", \n    size       = 1\n  ) +\n  coord_cartesian(ylim = c(30, 85)) +\n  xlab(\"GDP per capita\") +\n  ylab(\"Life Expectancy\") +\n  geom_segment(\n    aes(\n      xend = mean(gdpPercap),\n      yend = lifeExp,\n      color = \"GDP residuals\"\n    )\n  ) +\n  geom_segment(\n    aes(\n      xend = gdpPercap,\n      yend = mean(lifeExp),\n      color = \"Life Expectancy Residuals\"\n    )\n  ) +\n  geom_hline(\n    yintercept = mean(gapminder_2007$lifeExp), \n    linetype   = \"dashed\",  \n    color      = \"#006599\", \n    size       = 1\n  ) + theme(\n    legend.position = \"none\",\n    text=element_text(\n      family=\"gochi\"\n    )\n  )\nggsave(\"shared_resid.png\", shared_resid) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSaving 7 x 5 in image\n```\n:::\n\n```{.r .cell-code}\nshared_resid\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Comparing $shared$ $variance$ ($var_{xy}$) to $total$ $variance$\n\nTo complete a **Pearson's** **R** correlation we need to compare the amount that x and y vary together to the total variance (in which you calculate how much x and y vary separately and multiply them) to calculate the **proportion** of $total$ $variance$ is explained by the $shared$ $variance$ ($var_{xy}$).\n\n$$\n\\frac{var_{xy}}{totalVariance} = \\frac{(\\sum(x_i-\\bar{x})(y_i-\\bar{y}))/(N-1)}\n                                      {\\sqrt{\\sum(x_i-\\bar{x})^2*\\sum(y_i-\\bar{y})^2}/(N-1)}\n$$\n\nNote that both $var_{xy}$ and $totalVariance$ correct for the degrees of freedom, so the $N-1$s cancel each other out:\n\n$$\nr = \\frac{var_{xy}}{totalVariance} = \\frac{\\sum(x_i-\\bar{x})(y_i-\\bar{y})}\n                                      {\\sqrt{\\sum(x_i-\\bar{x})^2*\\sum(y_i-\\bar{y})^2}}\n$$\n\nLets apply this to the gapminder data above to calculate $r$:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvarxy = \n  sum(\n    (gapminder_2007$gdpPercap - mean(gapminder_2007$gdpPercap)) * \n    (gapminder_2007$lifeExp - mean(gapminder_2007$lifeExp))\n   )\n\n\ntotalvar = sqrt(\n  sum((gapminder_2007$gdpPercap - mean(gapminder_2007$gdpPercap))^2) * \n  sum((gapminder_2007$lifeExp - mean(gapminder_2007$lifeExp))^2)\n)\nvarxy/totalvar\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6786624\n```\n:::\n:::\n\n\nIf the above calculation is correct, we'll get exactly the same value when using the **cor.test** function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor.test(gapminder_2007$gdpPercap, gapminder_2007$lifeExp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's product-moment correlation\n\ndata:  gapminder_2007$gdpPercap and gapminder_2007$lifeExp\nt = 10.933, df = 140, p-value < 2.2e-16\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.5786217 0.7585843\nsample estimates:\n      cor \n0.6786624 \n```\n:::\n:::\n\n\nTo visualise what proportion of the variance is captured by $var_{xy}$:\n\n+:------------------------------------------------------------------------:+\n| ![](shared_resid.png)                                                    |\n+--------------------------------------------------------------------------+\n| ------------------------------------------------------------------------ |\n+--------------------------------------------------------------------------+\n| sqrt(![](life_exp_resid.png) \\\\\\^2                                       |\n+--------------------------------------------------------------------------+\n\nA question you might have at this point, is whether the above figure seems consistent with 67.9% of $total$ $variance$ being explained by overlapping variance between $x$ and $y$?\n\nIf $x$ and $y$ vary together, then you would expect either:\n\n-   a higher $x$ data point should be associated with a **higher** $y$ data point (positive association)\n\n-   a higher $x$ data point should be associated with a **lower** $y$ data point (negative association)\n\nThe bottom half of the figure above doesn't give you that much insight into how consistently $x$ and $y$ are positive or negatively associated with each other, but the top half does;\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshared_resid\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nIf there is a *positive association*, then you would expect there to be consistency in $x$ and $y$ both being above their own respective means, or both being below their respective means consistently, which is what we see above.\n\nIf there is a negative association, you would expect $y$ to generally be below its mean when $x$ is above its mean, and vice-versa. Lets visualise this by [transforming](../distributions/transforming.html){target=\"_blank\"}the $life$ $expectancy$ to be inverted by subtracting it from 100. This will make younger people older and older people younger:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninverted_resid <- ggplot(\n  data = gapminder_2007, \n  aes(\n    x=gdpPercap, \n    y=125-lifeExp\n  )\n) + \n  geom_point() +\n  geom_vline(\n    xintercept = mean(gapminder_2007$gdpPercap), \n    linetype   = \"dashed\",  \n    color      = \"#006599\", \n    size       = 1\n  ) +\n  coord_cartesian(ylim = c(30, 85)) +\n  xlab(\"GDP per capita\") +\n  ylab(\"Life Expectancy\") +\n  geom_segment(\n    aes(\n      xend = mean(gdpPercap),\n      yend = 125-lifeExp,\n      color = \"GDP residuals\"\n    )\n  ) +\n  geom_segment(\n    aes(\n      xend = gdpPercap,\n      yend = mean(125-lifeExp),\n      color = \"Life Expectancy Residuals\"\n    )\n  ) +\n  geom_hline(\n    yintercept = mean(125-gapminder_2007$lifeExp), \n    linetype   = \"dashed\",  \n    color      = \"#006599\", \n    size       = 1\n  ) + theme(\n    legend.position = \"none\",\n    text=element_text(\n      family=\"gochi\"\n    )\n  )\n\ninverted_resid\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nThe $Pearson's$ $r$ is now the reverse of the data before this transformation, i.e. r=-.679. Notice how there's consistency in the above average $x$ values being associated with below average $y$ values, and vice-versa.\n\nYou may have noticed that the data above looks like it's not normally distributed, so lets check skewness and kurtosis to see if we should use Spearman's Rho (AKA Spearman's Rank) instead:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Skewness and kurtosis and their standard errors as implement by SPSS\n#\n# Reference: pp 451-452 of\n# http://support.spss.com/ProductsExt/SPSS/Documentation/Manuals/16.0/SPSS 16.0 Algorithms.pdf\n# \n# See also: Suggestion for Using Powerful and Informative Tests of Normality,\n# Ralph B. D'Agostino, Albert Belanger, Ralph B. D'Agostino, Jr.,\n# The American Statistician, Vol. 44, No. 4 (Nov., 1990), pp. 316-321\n\nspssSkewKurtosis=function(x) {\n  w=length(x)\n  m1=mean(x)\n  m2=sum((x-m1)^2)\n  m3=sum((x-m1)^3)\n  m4=sum((x-m1)^4)\n  s1=sd(x)\n  skew=w*m3/(w-1)/(w-2)/s1^3\n  sdskew=sqrt( 6*w*(w-1) / ((w-2)*(w+1)*(w+3)) )\n  kurtosis=(w*(w+1)*m4 - 3*m2^2*(w-1)) / ((w-1)*(w-2)*(w-3)*s1^4)\n  sdkurtosis=sqrt( 4*(w^2-1) * sdskew^2 / ((w-3)*(w+5)) )\n\n  ## z-scores added by reading-psych\n  zskew = skew/sdskew\n  zkurtosis = kurtosis/sdkurtosis\n\n  mat=matrix(c(skew,kurtosis, sdskew,sdkurtosis, zskew, zkurtosis), 2,\n        dimnames=list(c(\"skew\",\"kurtosis\"), c(\"estimate\",\"se\",\"zScore\")))\n  return(mat)\n}\nspssSkewKurtosis(gapminder_2007$gdpPercap)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          estimate        se    zScore\nskew     1.2241977 0.2034292 6.0178067\nkurtosis 0.3500942 0.4041614 0.8662238\n```\n:::\n\n```{.r .cell-code}\nspssSkewKurtosis(gapminder_2007$lifeExp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           estimate        se    zScore\nskew     -0.6887771 0.2034292 -3.385832\nkurtosis -0.8298204 0.4041614 -2.053191\n```\n:::\n:::\n\n\nAs GDP and Life Expectancy skewness and (kurtosis for life expectancy) estimates are more than 1.96 \\* their standard errors (i.e. their z-scores are above 1.96), we have significant evidence that the data for both variabels is *not* normally distributed, and thus we can/should complete a Spearman's Rank/Rho correlation (in the next subsection).\n\n## Spearman's Rank (AKA Spearman's Rho)\n\n**Spearman's Rank** correlation is identical to a Pearson correlation (described above), but adds a step of converting all the data into ranks before conducting any analyses. This is useful because **ranks** are not vulnerable to outlier (i.e. unusually extreme) data points. Let's now turn the gapminder data we've been working with above into ranks and then run a Pearson's correlation on it to confirm this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngapminder_2007$gdpPercap_rank <- rank(gapminder_2007$gdpPercap)\ngapminder_2007$lifeExp_rank <- rank(gapminder_2007$lifeExp)\n```\n:::\n\n\nLets do a quick check to see that ranking the data addresses the problems with skewness and kurtosis:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspssSkewKurtosis(gapminder_2007$gdpPercap_rank)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         estimate        se    zScore\nskew          0.0 0.2034292  0.000000\nkurtosis     -1.2 0.4041614 -2.969111\n```\n:::\n\n```{.r .cell-code}\nspssSkewKurtosis(gapminder_2007$lifeExp_rank)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         estimate        se    zScore\nskew          0.0 0.2034292  0.000000\nkurtosis     -1.2 0.4041614 -2.969111\n```\n:::\n:::\n\n\nThis has successfully removed any issue with skewness of the data, but has made the data more platykurtic (i.e. flatter). A problem with platykurtic data is that parametric tests might be **over** sensitive to identifying significant effects (see <a href=\"../distributions/kurtosis.qmd\" target=\"_blank\">kurtosis</a>), i.e. be at a higher risk of **false positives**. This is evidence that using a Spearman's Rank may increase a risk of a false-positive (at least with this data), so <a href=\"transforming\" target=\"_blank\">another transformation of the data</a> may be more appropriate to avoid this problem with kurtosis.\n\nFor now, lets focus on how much of the variance in ranks is explained in the overlap in variance of $gdp$ and $life$ $expectancy$ ranks:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pearson correlation on **ranked** data:\ncor.test(gapminder_2007$gdpPercap_rank, gapminder_2007$lifeExp_rank, method = \"pearson\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's product-moment correlation\n\ndata:  gapminder_2007$gdpPercap_rank and gapminder_2007$lifeExp_rank\nt = 19.642, df = 140, p-value < 2.2e-16\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.8055253 0.8950257\nsample estimates:\n      cor \n0.8565899 \n```\n:::\n\n```{.r .cell-code}\n# Spearman correlation applied to original data (letting R do the ranking)\ncor.test(gapminder_2007$gdpPercap, gapminder_2007$lifeExp, method = \"spearman\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tSpearman's rank correlation rho\n\ndata:  gapminder_2007$gdpPercap and gapminder_2007$lifeExp\nS = 68434, p-value < 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n      rho \n0.8565899 \n```\n:::\n:::\n\n\nThe $r$ value is now .857, suggesting that the overlap between $gdp$ and $life$ $expectancy$ explains 85.7% of the total variance of the ranks for both of them.\n\nLets visualise this using similar principles above on the **ranks** of $gdp$ and $life$ $expectancy$:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrank_resid <- ggplot(\n  data = gapminder_2007, \n  aes(\n    x=gdpPercap_rank, \n    y=lifeExp_rank\n  )\n) + \n  geom_point() +\n  geom_vline(\n    xintercept = mean(gapminder_2007$gdpPercap_rank), \n    linetype   = \"dashed\",  \n    color      = \"#006599\", \n    size       = 1\n  ) +\n  #coord_cartesian(ylim = c(30, 85)) +\n  xlab(\"GDP per capita (RANK)\") +\n  ylab(\"Life Expectancy (RANK)\") +\n  geom_segment(\n    aes(\n      xend = mean(gdpPercap_rank),\n      yend = lifeExp_rank,\n      color = \"GDP residuals\"\n    )\n  ) +\n  geom_segment(\n    aes(\n      xend = gdpPercap_rank,\n      yend = mean(lifeExp_rank),\n      color = \"Life Expectancy Residuals\"\n    )\n  ) +\n  geom_hline(\n    yintercept = mean(gapminder_2007$lifeExp_rank), \n    linetype   = \"dashed\",  \n    color      = \"#006599\", \n    size       = 1\n  ) + theme(\n    legend.position = \"none\",\n    text=element_text(\n      family=\"gochi\",\n      size = 20\n    )\n  )\n\nrank_resid\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nYou may notice that the variance from the mean in X and Y is more aligned in this figure than it was in the data before it was transformed into ranks (and is less skewed!):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshared_resid\n```\n\n::: {.cell-output-display}\n![](correlations_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "correlations_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}